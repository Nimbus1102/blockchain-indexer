# Blockchain Indexing Assignment (Rust/C++)

> This task is created to mimic some activities in BR Blockchain Engineering.

Below is an exercise for you to implement an index for blockchain. 200 blocks are provided within the `200.json` file
that is generated from our testing environment.

---

### Brief Introduction to Blockchain

#### What is a Blockchain?

The blockchain is a distributed database (a ledger of transactions). Each node (participant) in the network holds a copy
of the database. Transactions are broadcasted by nodes to one another in a peer-to-peer fashion. When a transaction is
received by a node, it performs validation to ensure the transaction follows the network's pre-defined
rules. [Learn more about the bitcoin blockchain here](https://www.youtube.com/watch?v=bBC-nXj3Ng4)

#### What is a Block?

> https://www.investopedia.com/terms/b/block-bitcoin-block.asp

A block records some or all of the most recent transactions that have not yet entered any prior blocks. Thus, a block is
like a page of a ledger or record book. Each time a block is created, it gives way to the next block in the blockchain.
A block is uniquely identified by its hash, and will have a reference to its predecessor's hash.

#### What is a Transaction?

Bitcoin and hence DeFiChain is a UTXO-based blockchain. The UTXO model is very different from what we're used to with
our traditional banks and accounts (i.e. Account model). Learn more about UTXO with
this [video](https://www.youtube.com/watch?v=-xoCoZGJ9AQ).

Vin = spending, Vout = unspent.

> `Coinbase VIN -> TXN VOUT -> TXN VIN -> TXN VOUT -> TXN VIN -> TXN VOUT`
> Coinbase Vin = generated by the miner as their mining reward. Transaction Vout is unspent balances within that block.
> Transaction Vin can take a previous Transaction Vout and spend it.

```
blocks[]
├─ block-0/transactions[]
│  ├─ transaction-0
│  │  ├─ [vins]
│  │  │  ├─ vin-0
│  │  │  └─ vin-1
│  │  └─ [vouts]
│  │     ├─ vout-0
│  │     └─ vout-1
│  ├─ transaction-1
│  └─ transaction-2
├─ block-1
├─ block-2
```

#### What is an index for blockchain?

Say you wanted to perform an aggregate query across blocks generated from 2020 to 2022, summing the total volume of
transactions. Unfortunately, the blockchain node only exposes 1 endpoint for you - `getBlock(heightOrHash)` - which only
allows you to query for 1 block at any given time. How then can you make such aggregate queries performant and complete
within the sub-millisecond range?

Enter the blockchain _Indexer_, whose sole objective is to make querying blockchain data fast and easy.

You can think of the blocks in the blockchain as an event log. Using the event sourcing pattern, the indexes are highly
performant read streams created for a particular feature. An example of a read stream/index would be an address
transaction history.

---

## Assignment

For this open-ended assignment, you will need to implement an index with the ~200 blocks provided. For starters, 3
indexes would be enough for this assignment. You must use Rust or C++, however you can use any tools, framework,
database and patterns of your choice for the read stream. It's up to you to decide on the attributes for each entity.
Focus more on the event sourcing pattern and indexing aspect of this assignment. Create a simple yet scalable way to
index data at scale.

Feel free to state your assumption. REST endpoint are included for your convenience to visualise the index designs, you
don't need to provide an HTTP interfacing layer. Programmatically implemented is enough.

### Block Index

- `/api/blocks`: block[]
- `/api/blocks?maxHeight=`: block[]
- `/api/blocks/{height}`: block
- `/api/blocks/{hash}`: block

Block index would be very similar to the blocks you get from the ledger, indexing the blocks in `height` order. The API
would allow developers to query blocks sorting by height with the latest block first. Additionally, you might want to
allow querying by block hash.

**Note that a fork is simulated at height 198**. Your indexer should return only 1
block (`ef61aaf7f6f742ed825922b10ec504ee74cfcb9c71037706dd8a8FORKEDBLOCK`) for this height, as it is the best chain (
block 199 follows this block, indicating that the FORKEDBLOCK is now part of the blockchain, instead of the other one at
height 198).

### Block Transactions Index

- `/api/blocks/{height}/transactions`: transaction[]

This index would provide the ability to query for transactions within a block (given its height or hash).

### Address Transaction Index

- `/api/addresses/{address}/transactions`: transaction[]

Each transaction would have its accompanying address on both [Vin and Vout](#transactions). This index should provide
the ability to query all transactions scoped to the address.

### Tests

Writing robust automated tests is essential. To demonstrate that your code works, write some tests in a test framework
of your choice - the more test coverage, the better.

### Continuous Integration

The practice of automating the integration of code changes is very essential to scaling any engineering project. To
demonstrate that your code works all environment beyond your local environment, you are required to write 2 workflows
using [GitHub Actions](https://github.com/features/actions).

- "CI / Build" workflow to automate building of the project.
- "CI / Test" workflow to automate testing of the project.

A template file is included for convenience:

```yml
name: CI

on:
  push:
  pull_request:

jobs:
  Build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@2541b1294d2704b0964813337f33b291d3f8596b
      # TODO automate building

  Test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@2541b1294d2704b0964813337f33b291d3f8596b
      # TODO automate testing
```

### Notes

- To manage your time well. You are not expected to spend more than two days on this.
- There is no correct/perfect solution to this as this is an open-ended task.
- This exercise is created to match our engineering activities to get you assimilated into our day-to-day activities.

### Submission

1. GitHub Repo URL (with invitations)
   1. @fuxingloh
2. Short write-up of what you have done.
3. Any suggestions for improving this task. (optional)
4. Anything stands out to you. (optional)
5. Comments (optional)
